<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/krakenjs/kraken-js#readme"

    >kraken-js (v2.1.0)</a>
</h1>
<h4>An express-based Node.js web application bootstrapping module.</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js">module kraken-js</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.kraken-js">
            function <span class="apidocSignatureSpan"></span>kraken-js
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.404">
            function <span class="apidocSignatureSpan">kraken-js.</span>404
            <span class="apidocSignatureSpan">(arg0)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.500">
            function <span class="apidocSignatureSpan">kraken-js.</span>500
            <span class="apidocSignatureSpan">(arg0)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.bootstrap">
            function <span class="apidocSignatureSpan">kraken-js.</span>bootstrap
            <span class="apidocSignatureSpan">(app, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.events">
            function <span class="apidocSignatureSpan">kraken-js.</span>events
            <span class="apidocSignatureSpan">(app)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.middleware">
            function <span class="apidocSignatureSpan">kraken-js.</span>middleware
            <span class="apidocSignatureSpan">(app)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.multipart">
            function <span class="apidocSignatureSpan">kraken-js.</span>multipart
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.settings">
            function <span class="apidocSignatureSpan">kraken-js.</span>settings
            <span class="apidocSignatureSpan">(app, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.shutdown">
            function <span class="apidocSignatureSpan">kraken-js.</span>shutdown
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.toString">
            function <span class="apidocSignatureSpan">kraken-js.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.views">
            function <span class="apidocSignatureSpan">kraken-js.</span>views
            <span class="apidocSignatureSpan">(app)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">kraken-js.</span>config</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.404">module kraken-js.404</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.404.404">
            function <span class="apidocSignatureSpan">kraken-js.</span>404
            <span class="apidocSignatureSpan">(arg0)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.500">module kraken-js.500</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.500.500">
            function <span class="apidocSignatureSpan">kraken-js.</span>500
            <span class="apidocSignatureSpan">(arg0)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.bootstrap">module kraken-js.bootstrap</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.bootstrap.bootstrap">
            function <span class="apidocSignatureSpan">kraken-js.</span>bootstrap
            <span class="apidocSignatureSpan">(app, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.config">module kraken-js.config</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.config.create">
            function <span class="apidocSignatureSpan">kraken-js.config.</span>create
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.events">module kraken-js.events</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.events.events">
            function <span class="apidocSignatureSpan">kraken-js.</span>events
            <span class="apidocSignatureSpan">(app)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.middleware">module kraken-js.middleware</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.middleware.middleware">
            function <span class="apidocSignatureSpan">kraken-js.</span>middleware
            <span class="apidocSignatureSpan">(app)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.multipart">module kraken-js.multipart</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.multipart.multipart">
            function <span class="apidocSignatureSpan">kraken-js.</span>multipart
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.settings">module kraken-js.settings</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.settings.settings">
            function <span class="apidocSignatureSpan">kraken-js.</span>settings
            <span class="apidocSignatureSpan">(app, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.shutdown">module kraken-js.shutdown</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.shutdown.shutdown">
            function <span class="apidocSignatureSpan">kraken-js.</span>shutdown
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.toString">module kraken-js.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.toString.toString">
            function <span class="apidocSignatureSpan">kraken-js.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kraken-js.views">module kraken-js.views</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kraken-js.views.views">
            function <span class="apidocSignatureSpan">kraken-js.</span>views
            <span class="apidocSignatureSpan">(app)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js" id="apidoc.module.kraken-js">module kraken-js</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.kraken-js" id="apidoc.element.kraken-js.kraken-js">
        function <span class="apidocSignatureSpan"></span>kraken-js
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">kraken-js = function (options) {
    var app;

    if (typeof options === &#x27;string&#x27;) {
        options = { basedir: options };
    }

    options = options || {};
    options.protocols    = options.protocols || {};
    options.onconfig     = options.onconfig || noop;
    options.basedir      = options.basedir || path.dirname(caller());
    options.mountpath    = null;
    options.inheritViews = !!options.inheritViews;

    debug(&#x27;kraken options\n&#x27;, options);

    app = express();
    app.once(&#x27;mount&#x27;, function onmount(parent) {
        var start, error, promise;

        // Remove sacrificial express app
        parent._router.stack.pop();

        // Since this particular `app` instance is
        // subsequently deleted, the `mountpath` is
        // moved to `options` for use later.
        options.mountpath = app.mountpath;

        start = parent.emit.bind(parent, &#x27;start&#x27;);
        error = parent.emit.bind(parent, &#x27;error&#x27;);

        // Kick off server and add middleware which will block until
        // server is ready. This way we don&#x27;t have to block standard
        // `listen` behavior, but failures will occur immediately.
        promise = bootstrap(parent, options);
        promise.then(start, error);


        parent.use(function startup(req, res, next) {
            var headers = options.startupHeaders;

            if (promise.isPending()) {
                res.status(503);
                if (headers) {
                    res.header(headers);
                }
                res.send(&#x27;Server is starting.&#x27;);
                return;
            }

            if (promise.isRejected()) {
                res.status(503);
                res.send(&#x27;The application failed to start.&#x27;);
                return;
            }

            next();
        });
    });

    return app;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.404" id="apidoc.element.kraken-js.404">
        function <span class="apidocSignatureSpan">kraken-js.</span>404
        <span class="apidocSignatureSpan">(arg0)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">404 = function (arg0) {
&#x22;use strict&#x22;
log.call(deprecate, message, site)
return fn.apply(this, arguments)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.500" id="apidoc.element.kraken-js.500">
        function <span class="apidocSignatureSpan">kraken-js.</span>500
        <span class="apidocSignatureSpan">(arg0)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">500 = function (arg0) {
&#x22;use strict&#x22;
log.call(deprecate, message, site)
return fn.apply(this, arguments)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.bootstrap" id="apidoc.element.kraken-js.bootstrap">
        function <span class="apidocSignatureSpan">kraken-js.</span>bootstrap
        <span class="apidocSignatureSpan">(app, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">bootstrap = function (app, options) {

    endgame(options.uncaughtException);

    return settings(app, options)
        .then(views)
        .then(middleware)
        .then(events)
        .then(function complete() {
            debug(&#x27;init complete&#x27;);
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.events" id="apidoc.element.kraken-js.events">
        function <span class="apidocSignatureSpan">kraken-js.</span>events
        <span class="apidocSignatureSpan">(app)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function events(app) {
    var timer;

    app.on(&#x27;shutdown&#x27;, function onshutdown(server, timeout) {
        var stop, ok, err;

        stop = function (code) {
            app.emit(&#x27;stop&#x27;);
            process.exit(code);
        };

        ok = stop.bind(null, 0);
        err = stop.bind(null, 1);

        debug(&#x27;process shutting down&#x27;);
        server.close(ok);
        clearTimeout(timer);
        timer = setTimeout(err, timeout);
    });

    return app;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.middleware" id="apidoc.element.kraken-js.middleware">
        function <span class="apidocSignatureSpan">kraken-js.</span>middleware
        <span class="apidocSignatureSpan">(app)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function middleware(app) {
    var config;

    debug(&#x27;initializing middleware&#x27;);
    config = app.kraken.get(&#x27;middleware&#x27;) || {};
    app.use(app.settings.mountpath, meddleware(config));

    return app;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.multipart" id="apidoc.element.kraken-js.multipart">
        function <span class="apidocSignatureSpan">kraken-js.</span>multipart
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">multipart = function (config) {
    config = config || {};

    return filter(function (req, res, next) {
        var form = new IncomingForm(config);
        form.parse(req, function (err, fields, files) {
            if (err) {
                next(err);
                return;
            }

            req.body = fields;
            req.files = files;
            res.once(&#x27;finish&#x27;, cleanify(files));
            next();
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.settings" id="apidoc.element.kraken-js.settings">
        function <span class="apidocSignatureSpan">kraken-js.</span>settings
        <span class="apidocSignatureSpan">(app, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function settings(app, options) {
    debug(&#x27;initializing settings&#x27;);

    function mount(app, options, config) {
        var settings, defaults, handler;

        // Get configured settings and express defaults.
        settings = config.get(&#x27;express&#x27;);
        defaults = Object.keys(app.settings);

        if (options.inheritViews) {
            // If the mounted app SHOULD inherit views, delete from local
            // kraken settings so the app settings aren&#x27;t updated later.
            handler = function (name) {
                debug(&#x27;inheriting express config setting&#x27;, &#x27;\&#x27;&#x27; + name + &#x27;\&#x27;&#x27;, &#x27;from parent&#x27;);
                delete settings[name];
            };

        } else {
            // If the views SHOULD NOT be inherited, remove from list
            // of default settings such that they are NOT deleted below.
            handler = function (name) {
                var idx = defaults.indexOf(name);
                if (idx &#x3e;= 0) {
                    defaults.splice(idx, 1);
                }
            };
        }

        // Update our configuration (provided settings or app defaults)
        VIEW_CONFIG_KEYS.forEach(handler);

        // Now delete the default app settings so they may be inherited
        // from the parent app. Any remaining kraken config will be set
        // during setting initialization.
        defaults.forEach(function (name) {
            delete app.settings[name];
        });
    }


    function compose(config) {
        // If this application is mounted on a parent app we need to make sure
        // the two work together cleanly and appropriate settings are inherited.
        if (typeof app.parent === &#x27;function&#x27;) {
            // If it has already been mounted do all the work to update settings.
            mount(app, options, config);
        } else {
            // ...if it hasn&#x27;t been mounted, register a handler for the `mount`
            // event to apply them as necessary.
            app.once(&#x27;mount&#x27;, function () {
                mount(this, options, config);
            });
        }

        return config;
    }


    function complete(config) {
        var settings;

        settings = config.get(&#x27;express&#x27;);

        // Allow configuration of custom View impl. This really can be
        // accomplished using shortstop, but maintain for compatibility.
        if (typeof settings.view === &#x27;string&#x27;) {
            settings.view = require(settings.view);
        }

        // Override default settings, leaving the settings object
        // intact to maintain express&#x27; setting inheritance.
        Object.keys(settings).forEach(function (name) {
            app.set(name, settings[name]);
        });

        if (options.inheritViews) {
            // Update kraken config to reflect express settings
            // for view options. Previously, the view settings
            // were removed from config so only the appropriate
            // settings were copied into express. At this point
            // the app has been mounted and configures, so parent
            // values are available to update kraken config as
            // appropriate.
            VIEW_CONFIG_KEYS.forEach(function (name) {
                config.set(&#x27;express:&#x27; + name, app.get(name));
            });
        }

        // If options.mountpath was set, override config settings.
        app.set(&#x27;mountpath&#x27;, ((typeof options.mountpath === &#x27;string&#x27;) &#x26;&#x26; options.mountpath !== &#x27;/&#x27;) ? options.mountpath : app.get
(&#x27;mountpath&#x27;));
        app.set(&#x27;trust proxy&#x27;, config.get(&#x27;express:trust proxy&#x27;));
        app.set(&#x27;env&#x27;, config.get(&#x27;env:env&#x27;));
        app.kraken = config;

        debug(&#x27;express settings\n&#x27;, app.settings);
        return app;
    }

    return config.create(options)
        .then(Bluebird.promisify(options.onconfig))
        .then(compose)
        .then(complete);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.shutdown" id="apidoc.element.kraken-js.shutdown">
        function <span class="apidocSignatureSpan">kraken-js.</span>shutdown
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">shutdown = function (config) {
    var template, timeout, state, app, server, once, uncaughtException;

    function close() {
        state = States.DISCONNECTING;
        app.emit(&#x27;shutdown&#x27;, server, timeout);
    }

    config = config || {};
    template = config.template;
    timeout = config.timeout || 10 * 1000;
    state = States.CONNECTED;
    uncaughtException = thing.isFunction(config.uncaughtException) &#x26;&#x26; config.uncaughtException;

    once = onceThunk();

    return function shutdown(req, res, next) {
        var headers, d;

        headers = config.shutdownHeaders || {};

        function json() {
            res.send({message: &#x27;Server is shutting down.&#x27;});
        }

        function html() {
            template ? res.render(template) : json();
        }

        if (state === States.DISCONNECTING) {
            headers.Connection = headers.Connection || &#x27;close&#x27;;
            res.header(headers);
            res.status(503);
            res.format({
                json: json,
                html: html
            });
            return;
        }

        if (!app) {
            // Lazy-bind - only attempt clean shutdown
            // if we&#x27;ve taken at least one request.
            app = req.app;
            server = req.socket.server;

            once(process, [&#x27;SIGTERM&#x27;, &#x27;SIGINT&#x27;], close);
        }

        d = domain.create();

        d.add(req);
        d.add(res);

        d.run(function () {
            next();
        });

        d.once(&#x27;error&#x27;, function (error) {
            if (uncaughtException) {
                uncaughtException(error, req, res, next);
                return;
            }

            console.error(new Date().toUTCString(), &#x27;UNCAUGHT&#x27;, error.message);
            console.error(error.stack);

            next(error);

            close();
        });
    };

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.toString" id="apidoc.element.kraken-js.toString">
        function <span class="apidocSignatureSpan">kraken-js.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
    return text;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kraken-js.views" id="apidoc.element.kraken-js.views">
        function <span class="apidocSignatureSpan">kraken-js.</span>views
        <span class="apidocSignatureSpan">(app)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function views(app) {
    var engines;

    debug(&#x27;initializing views&#x27;);

    engines = app.kraken.get(&#x27;view engines&#x27;) || {};
    Object.keys(engines).forEach(function (ext) {
        var spec, module, args, engine;

        spec = engines[ext];
        module = require(spec.module);

        if (thing.isObject(spec.renderer) &#x26;&#x26; thing.isFunction(module[spec.renderer.method])) {
            args = Array.isArray(spec.renderer[&#x27;arguments&#x27;]) ? spec.renderer[&#x27;arguments&#x27;].slice() : [];
            engine = module[spec.renderer.method].apply(null, args);

        } else if (thing.isString(spec.renderer) &#x26;&#x26; thing.isFunction(module[spec.renderer])) {
            engine = module[spec.renderer];

        } else if (thing.isFunction(module[spec.name])) {
            engine = module[spec.name];

        } else if (thing.isFunction(module[ext])) {
            engine = module[ext];

        } else {
            engine = module;
        }

        app.engine(ext, engine);
    });

    return app;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.404" id="apidoc.module.kraken-js.404">module kraken-js.404</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.404.404" id="apidoc.element.kraken-js.404.404">
        function <span class="apidocSignatureSpan">kraken-js.</span>404
        <span class="apidocSignatureSpan">(arg0)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">404 = function (arg0) {
&#x22;use strict&#x22;
log.call(deprecate, message, site)
return fn.apply(this, arguments)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.500" id="apidoc.module.kraken-js.500">module kraken-js.500</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.500.500" id="apidoc.element.kraken-js.500.500">
        function <span class="apidocSignatureSpan">kraken-js.</span>500
        <span class="apidocSignatureSpan">(arg0)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">500 = function (arg0) {
&#x22;use strict&#x22;
log.call(deprecate, message, site)
return fn.apply(this, arguments)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.bootstrap" id="apidoc.module.kraken-js.bootstrap">module kraken-js.bootstrap</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.bootstrap.bootstrap" id="apidoc.element.kraken-js.bootstrap.bootstrap">
        function <span class="apidocSignatureSpan">kraken-js.</span>bootstrap
        <span class="apidocSignatureSpan">(app, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">bootstrap = function (app, options) {

    endgame(options.uncaughtException);

    return settings(app, options)
        .then(views)
        .then(middleware)
        .then(events)
        .then(function complete() {
            debug(&#x27;init complete&#x27;);
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.config" id="apidoc.module.kraken-js.config">module kraken-js.config</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.config.create" id="apidoc.element.kraken-js.config.create">
        function <span class="apidocSignatureSpan">kraken-js.config.</span>create
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function create(options) {
    var deferred, appProtocols, baseProtocols, baseFactory, appFactory;

    deferred = Bluebird.pending();
    appProtocols = createHandlers(options);
    baseProtocols = createHandlers(options);

    appProtocols.resolve = ssresolve(configPath(options.basedir));
    baseProtocols.resolve = ssresolve(configPath(path.dirname(__dirname)));

    baseFactory = confit({ basedir: configPath(path.dirname(__dirname)), protocols: baseProtocols });
    baseFactory.create(function(err, baseConf) {
        if (err) {
            deferred.reject(err);
            return;
        }

        appFactory = confit({
          basedir: configPath(options.basedir),
          protocols: appProtocols
        });
        appFactory.create(function(err, appConf) {
            if (err) {
                deferred.reject(err);
                return;
            }

            baseConf.merge(appConf);
            deferred.resolve(baseConf);
        });
    });

    return deferred.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    appProtocols = createHandlers(options);
    baseProtocols = createHandlers(options);

    appProtocols.resolve = ssresolve(configPath(options.basedir));
    baseProtocols.resolve = ssresolve(configPath(path.dirname(__dirname)));

    baseFactory = confit({ basedir: configPath(path.dirname(__dirname)), protocols: baseProtocols });
    baseFactory.<span class="apidocCodeKeywordSpan">create</span>(function(err, baseConf) {
if (err) {
    deferred.reject(err);
    return;
}

appFactory = confit({
  basedir: configPath(options.basedir),
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.events" id="apidoc.module.kraken-js.events">module kraken-js.events</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.events.events" id="apidoc.element.kraken-js.events.events">
        function <span class="apidocSignatureSpan">kraken-js.</span>events
        <span class="apidocSignatureSpan">(app)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function events(app) {
    var timer;

    app.on(&#x27;shutdown&#x27;, function onshutdown(server, timeout) {
        var stop, ok, err;

        stop = function (code) {
            app.emit(&#x27;stop&#x27;);
            process.exit(code);
        };

        ok = stop.bind(null, 0);
        err = stop.bind(null, 1);

        debug(&#x27;process shutting down&#x27;);
        server.close(ok);
        clearTimeout(timer);
        timer = setTimeout(err, timeout);
    });

    return app;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.middleware" id="apidoc.module.kraken-js.middleware">module kraken-js.middleware</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.middleware.middleware" id="apidoc.element.kraken-js.middleware.middleware">
        function <span class="apidocSignatureSpan">kraken-js.</span>middleware
        <span class="apidocSignatureSpan">(app)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function middleware(app) {
    var config;

    debug(&#x27;initializing middleware&#x27;);
    config = app.kraken.get(&#x27;middleware&#x27;) || {};
    app.use(app.settings.mountpath, meddleware(config));

    return app;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.multipart" id="apidoc.module.kraken-js.multipart">module kraken-js.multipart</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.multipart.multipart" id="apidoc.element.kraken-js.multipart.multipart">
        function <span class="apidocSignatureSpan">kraken-js.</span>multipart
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">multipart = function (config) {
    config = config || {};

    return filter(function (req, res, next) {
        var form = new IncomingForm(config);
        form.parse(req, function (err, fields, files) {
            if (err) {
                next(err);
                return;
            }

            req.body = fields;
            req.files = files;
            res.once(&#x27;finish&#x27;, cleanify(files));
            next();
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.settings" id="apidoc.module.kraken-js.settings">module kraken-js.settings</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.settings.settings" id="apidoc.element.kraken-js.settings.settings">
        function <span class="apidocSignatureSpan">kraken-js.</span>settings
        <span class="apidocSignatureSpan">(app, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function settings(app, options) {
    debug(&#x27;initializing settings&#x27;);

    function mount(app, options, config) {
        var settings, defaults, handler;

        // Get configured settings and express defaults.
        settings = config.get(&#x27;express&#x27;);
        defaults = Object.keys(app.settings);

        if (options.inheritViews) {
            // If the mounted app SHOULD inherit views, delete from local
            // kraken settings so the app settings aren&#x27;t updated later.
            handler = function (name) {
                debug(&#x27;inheriting express config setting&#x27;, &#x27;\&#x27;&#x27; + name + &#x27;\&#x27;&#x27;, &#x27;from parent&#x27;);
                delete settings[name];
            };

        } else {
            // If the views SHOULD NOT be inherited, remove from list
            // of default settings such that they are NOT deleted below.
            handler = function (name) {
                var idx = defaults.indexOf(name);
                if (idx &#x3e;= 0) {
                    defaults.splice(idx, 1);
                }
            };
        }

        // Update our configuration (provided settings or app defaults)
        VIEW_CONFIG_KEYS.forEach(handler);

        // Now delete the default app settings so they may be inherited
        // from the parent app. Any remaining kraken config will be set
        // during setting initialization.
        defaults.forEach(function (name) {
            delete app.settings[name];
        });
    }


    function compose(config) {
        // If this application is mounted on a parent app we need to make sure
        // the two work together cleanly and appropriate settings are inherited.
        if (typeof app.parent === &#x27;function&#x27;) {
            // If it has already been mounted do all the work to update settings.
            mount(app, options, config);
        } else {
            // ...if it hasn&#x27;t been mounted, register a handler for the `mount`
            // event to apply them as necessary.
            app.once(&#x27;mount&#x27;, function () {
                mount(this, options, config);
            });
        }

        return config;
    }


    function complete(config) {
        var settings;

        settings = config.get(&#x27;express&#x27;);

        // Allow configuration of custom View impl. This really can be
        // accomplished using shortstop, but maintain for compatibility.
        if (typeof settings.view === &#x27;string&#x27;) {
            settings.view = require(settings.view);
        }

        // Override default settings, leaving the settings object
        // intact to maintain express&#x27; setting inheritance.
        Object.keys(settings).forEach(function (name) {
            app.set(name, settings[name]);
        });

        if (options.inheritViews) {
            // Update kraken config to reflect express settings
            // for view options. Previously, the view settings
            // were removed from config so only the appropriate
            // settings were copied into express. At this point
            // the app has been mounted and configures, so parent
            // values are available to update kraken config as
            // appropriate.
            VIEW_CONFIG_KEYS.forEach(function (name) {
                config.set(&#x27;express:&#x27; + name, app.get(name));
            });
        }

        // If options.mountpath was set, override config settings.
        app.set(&#x27;mountpath&#x27;, ((typeof options.mountpath === &#x27;string&#x27;) &#x26;&#x26; options.mountpath !== &#x27;/&#x27;) ? options.mountpath : app.get
(&#x27;mountpath&#x27;));
        app.set(&#x27;trust proxy&#x27;, config.get(&#x27;express:trust proxy&#x27;));
        app.set(&#x27;env&#x27;, config.get(&#x27;env:env&#x27;));
        app.kraken = config;

        debug(&#x27;express settings\n&#x27;, app.settings);
        return app;
    }

    return config.create(options)
        .then(Bluebird.promisify(options.onconfig))
        .then(compose)
        .then(complete);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.shutdown" id="apidoc.module.kraken-js.shutdown">module kraken-js.shutdown</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.shutdown.shutdown" id="apidoc.element.kraken-js.shutdown.shutdown">
        function <span class="apidocSignatureSpan">kraken-js.</span>shutdown
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">shutdown = function (config) {
    var template, timeout, state, app, server, once, uncaughtException;

    function close() {
        state = States.DISCONNECTING;
        app.emit(&#x27;shutdown&#x27;, server, timeout);
    }

    config = config || {};
    template = config.template;
    timeout = config.timeout || 10 * 1000;
    state = States.CONNECTED;
    uncaughtException = thing.isFunction(config.uncaughtException) &#x26;&#x26; config.uncaughtException;

    once = onceThunk();

    return function shutdown(req, res, next) {
        var headers, d;

        headers = config.shutdownHeaders || {};

        function json() {
            res.send({message: &#x27;Server is shutting down.&#x27;});
        }

        function html() {
            template ? res.render(template) : json();
        }

        if (state === States.DISCONNECTING) {
            headers.Connection = headers.Connection || &#x27;close&#x27;;
            res.header(headers);
            res.status(503);
            res.format({
                json: json,
                html: html
            });
            return;
        }

        if (!app) {
            // Lazy-bind - only attempt clean shutdown
            // if we&#x27;ve taken at least one request.
            app = req.app;
            server = req.socket.server;

            once(process, [&#x27;SIGTERM&#x27;, &#x27;SIGINT&#x27;], close);
        }

        d = domain.create();

        d.add(req);
        d.add(res);

        d.run(function () {
            next();
        });

        d.once(&#x27;error&#x27;, function (error) {
            if (uncaughtException) {
                uncaughtException(error, req, res, next);
                return;
            }

            console.error(new Date().toUTCString(), &#x27;UNCAUGHT&#x27;, error.message);
            console.error(error.stack);

            next(error);

            close();
        });
    };

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.toString" id="apidoc.module.kraken-js.toString">module kraken-js.toString</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.toString.toString" id="apidoc.element.kraken-js.toString.toString">
        function <span class="apidocSignatureSpan">kraken-js.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kraken-js.views" id="apidoc.module.kraken-js.views">module kraken-js.views</a></h1>


    <h2>
        <a href="#apidoc.element.kraken-js.views.views" id="apidoc.element.kraken-js.views.views">
        function <span class="apidocSignatureSpan">kraken-js.</span>views
        <span class="apidocSignatureSpan">(app)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function views(app) {
    var engines;

    debug(&#x27;initializing views&#x27;);

    engines = app.kraken.get(&#x27;view engines&#x27;) || {};
    Object.keys(engines).forEach(function (ext) {
        var spec, module, args, engine;

        spec = engines[ext];
        module = require(spec.module);

        if (thing.isObject(spec.renderer) &#x26;&#x26; thing.isFunction(module[spec.renderer.method])) {
            args = Array.isArray(spec.renderer[&#x27;arguments&#x27;]) ? spec.renderer[&#x27;arguments&#x27;].slice() : [];
            engine = module[spec.renderer.method].apply(null, args);

        } else if (thing.isString(spec.renderer) &#x26;&#x26; thing.isFunction(module[spec.renderer])) {
            engine = module[spec.renderer];

        } else if (thing.isFunction(module[spec.name])) {
            engine = module[spec.name];

        } else if (thing.isFunction(module[ext])) {
            engine = module[ext];

        } else {
            engine = module;
        }

        app.engine(ext, engine);
    });

    return app;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
